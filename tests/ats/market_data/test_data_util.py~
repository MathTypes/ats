import datetime
import logging
import unittest.mock as mock

import numpy as np
import pandas as pd
import pandas_market_calendars as mcal
import pytz
import torch

from ats.calendar import market_time
from ats.market_data import data_util
from ats.util import logging_utils


def test_group_features():
    pd.set_option("display.max_columns", None)
    pd.set_option("display.max_rows", None)
    raw_data = {
        "ticker": ["ES", "ES", "ES"],
        "open": [1, 2, 3],
        "high": [3, 4, 5],
        "low": [1, 2, 3],
        "close": [3, 4, 5],
        "volume": [1, 2, 3],
        "dv": [1, 2, 3],
        "timestamp": [1325689200, 1325691000],
    }
    raw_data = pd.DataFrame(data=raw_data)
    raw_data = data_util.add_group_features(raw_data, "30M")
    logging.error(f"raw_data:{raw_data}")
    row_one = raw_data.iloc[1]
    logging.error(f"row_one:{row_one}")
    assert row_one["ticker"] == "ES"
    assert row_one["close_back"] == 3


if __name__ == "__main__":
    logging_utils.init_logging()
